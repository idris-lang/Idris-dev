sudo: false

language: c

addons:
  apt:
    sources:
      - hvr-ghc
    packages:
      - ghc-7.6.3
      - ghc-7.8.4
      - ghc-7.10.2
      - cabal-install-1.20
      - cabal-install-1.22
      # test dependencies
      - expect
      - cppcheck
      - hscolour
      # Stack dependencies
      - libgmp-dev

matrix:
  include:
    - env: CABALVER="1.20" GHCVER="7.6.3" TESTS="test_c"
      # separate caches for different compiler versions
      # until https://github.com/travis-ci/travis-ci/issues/4393 is resolved
      compiler: ": #GHC 7.6.3"
    - env: CABALVER="1.20" GHCVER="7.8.4" TESTS="lib_doc doc"
      compiler: ": #GHC 7.8.4"
    - env: CABALVER="1.20" GHCVER="7.8.4" TESTS="test_js"
      compiler: ": #GHC 7.8.4"
    - env: CABALVER="1.20" GHCVER="7.8.4" TESTS="test_c"
      compiler: ": #GHC 7.8.4"
    - env: CABALVER="1.22" GHCVER="7.10.2" TESTS="lib_doc doc"
      compiler: ": #GHC 7.10.2"
    - env: CABALVER="1.22" GHCVER="7.10.2" TESTS="test_js"
      compiler: ": #GHC 7.10.2"
    - env: CABALVER="1.22" GHCVER="7.10.2" TESTS="test_c"
      compiler: ": #GHC 7.10.2"
    - env: CABALVER="1.22" GHCVER="7.10.2" STACKTEST="stack_test"
      compiler: ": #GHC 7.10.2"


cache:
  directories:
    - $HOME/.cabsnap
    - $HOME/.cabal/packages
    - $HOME/.stack

before_cache:
  - rm -fv $HOME/.cabal/packages/hackage.haskell.org/build-reports.log
  - rm -fv $HOME/.cabal/packages/hackage.haskell.org/00-index.tar

before_install: ./scripts/travis-before-install.sh


install: ./scripts/travis-install.sh

before_script:
  - cabal sdist
  - cd ..
  - tar -xf Idris-dev/dist/idris*.tar.gz
  - cd idris*

script: ./scripts/travis-test.sh
